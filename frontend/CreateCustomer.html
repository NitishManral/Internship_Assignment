<!DOCTYPE html>
<html>
<head>
    <title>Customer List</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>Customer List</h1>
    <table id="customerTable">
        <tr>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Street</th>
            <th>Address</th>
            <th>City</th>
            <th>State</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Actions</th> <!-- New column for actions -->
        </tr>
    </table>
</body>
<script>
    const access_token = localStorage.getItem("access_token");
    console.log(access_token);
    function deleteCustomer(uuid){
        const url = "http://localhost:3000/api/assignment.jsp?cmd=delete&uuid=" + uuid;
        axios.post(url,{
            headers: {
                Authorization: "Bearer " + access_token,
                },
            })
            .then((res)=>{
                console.log(res.status);
            }).catch((err)=>{
                console.log(err);
            })
    }
    function editRecord(customer){
        let tablerow = document.getElementById(customer.uuid);
        console.log(tablerow);
        var cells = tablerow.getElementsByTagName('td');
            for (var i = 0; i < cells.length; i++) {
                cells[i].setAttribute('contenteditable', 'true');
            }
        const url = "http://localhost:3000/api/assignment.jsp?cmd=update&uuid=" + customer.uuid;

        axios.post(url,{
            headers: {
                Authorization: "Bearer " + access_token,
            },
            data: {
                    "first_name": customer.first_name,
                    "last_name":  customer.last_name,
                    "street":     customer.street,
                    "address":    customer.address,
                    "city":       customer.city,
                    "state":      customer.state,
                    "email":      customer.email,
                    "phone":      customer.phone,
                }
        })
    }
    function getCustomerList() {
        axios.get("http://localhost:3000/api/assignment.jsp?cmd=get_customer_list", {
            headers: {
                Authorization: "Bearer " + access_token,
            },
        })
        .then(function (response) {
            console.log(response);
            return response.data;
        }).then(function(customers) {
            var customerTable = document.getElementById("customerTable");
            customers.forEach(function(customer) {
                var row = customerTable.insertRow();
                row.id=customer.uuid;
                row.insertCell().textContent = customer.first_name;
                row.insertCell().textContent = customer.last_name;
                row.insertCell().textContent = customer.street;
                row.insertCell().textContent = customer.address;
                row.insertCell().textContent = customer.city;
                row.insertCell().textContent = customer.state;
                row.insertCell().textContent = customer.email;
                row.insertCell().textContent = customer.phone;
                
                // Create delete and edit buttons
                var actionsCell = row.insertCell();
                var deleteButton = document.createElement("button");
                deleteButton.textContent = "Delete";
                deleteButton.addEventListener("click", function() {
                    // Call delete function for the specific record
                    deleteCustomer(customer.uuid);
                });
                actionsCell.appendChild(deleteButton);
                
                var editButton = document.createElement("button");
                editButton.textContent = "Edit";
                editButton.addEventListener("click", function() {
                    // Call edit function for the specific record
                    
                    editRecord(customer);
                });
                actionsCell.appendChild(editButton);
            });
        })
        .catch(function (error) {
            // handle error
            console.log("error occurred");
            console.log(error);
        });
    }


    

    // Call the getCustomerList function when the page loads
    window.onload = getCustomerList;
</script>
</html>
                    
                });
        })
        .catch(function (error) {
                // handle error
                console.log("  error accured");
                console.log(error);
        });
    }

    // Call the getCustomerList function when the page loads
    window.onload = getCustomerList;
</script>
</html>
